<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <script src="js/config.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="Site oficial da Escola Antonio Austreg√©sio. Informa√ß√µes sobre matr√≠culas, avisos, professores e eventos." />
    <title>Escola Antonio Austreg√©sio</title>
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>
    <header>
        <div class="menu-superior">
            <img src="imagens/transferir.jpg" alt="Transferir" class="menu-img">
            <h1 class="menu-titulo">Antonio Austreg√©sio</h1>
            <img src="imagens/fundoMenu.png" alt="Prefeitura do Rio de Janeiro" class="menu-img">
        </div>
        <nav aria-label="Menu principal">
            <button id="menu-btn" aria-label="Abrir menu" class="menu-btn">
                <span></span><span></span><span></span>
            </button>
            <ul id="menu-list">
                <li><a href="index.html">In√≠cio</a></li>
                <li><a href="quem-somos.html">Quem Somos</a></li>
                <li><a href="professores.html">Professores</a></li>
                <li><a href="avisos.html">Avisos</a></li>
                <li><a href="galeria.html">Galeria</a></li>
                <li><a href="contato.html">Contato</a></li>
                <li><a href="admin.html">Admin</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <!-- Tirar coment√°rios quando come√ßar o periodo de rematricula -->
        <!-- <section class="info-rapida">
            <span class="icon">üì¢</span>
            <div>
                <strong>Matr√≠culas abertas para 2025!</strong><br>
                Venha conhecer nossa escola, agende uma visita pelo WhatsApp:
                <a href="https://wa.me/5588999999999" target="_blank"
                    style="color:#0059b3;text-decoration:underline;">Clique aqui</a><br>
                Endere√ßo: Rua das Flores, 123 - Centro, Cidade/UF
            </div>
        </section> -->
        <section class="destaques" aria-labelledby="destaques">
            <h3 id="destaques">Destaques</h3>
            <div class="destaque-cards" id="destaque-cards"></div>
        </section>
        <section class="videos">
  <h3>V√≠deos da Escola</h3>

  <div class="video-carousel" id="video-carousel">
    <button class="carousel-btn carousel-prev" aria-label="Anterior">&#10094;</button>
    <div class="carousel-viewport">
      <div class="carousel-track" id="video-track"></div>
    </div>
    <button class="carousel-btn carousel-next" aria-label="Pr√≥ximo">&#10095;</button>
  </div>
</section>
        <section class="depoimentos">
            <h3>Depoimentos</h3>
            <div class="depoimento">"A escola mudou a vida do meu filho, s√≥ tenho a agradecer!"<br><strong>- Maria, m√£e
                    de aluno</strong></div>
            <div class="depoimento">"Aqui aprendi a ser cidad√£o e a sonhar alto."<br><strong>- Jo√£o, ex-aluno</strong>
            </div>
            <div class="depoimento">"Equipe dedicada e ambiente acolhedor."<br><strong>- Ana, professora</strong></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 Escola Antonio Austreg√©sio</p>
    </footer>
    <script>
        // Menu hamb√∫rguer responsivo
        const menuBtn = document.getElementById('menu-btn');
        const menuList = document.getElementById('menu-list');
        menuBtn.addEventListener('click', () => {
            menuList.classList.toggle('show');
        });
        document.addEventListener('click', function (e) {
            if (window.innerWidth <= 900 && !menuBtn.contains(e.target) && !menuList.contains(e.target)) {
                menuList.classList.remove('show');
            }
        });

        // Destaques din√¢micos
        fetch(`${API_URL}/destaques`)
            .then(res => res.json())
            .then(destaques => {
                const lista = document.getElementById('destaque-cards');
                lista.innerHTML = '';
                const icons = ['üéâ', 'üìÖ', '‚≠ê', 'üì¢', 'üè´', 'üìù', 'üéì', 'üèÜ', 'üì∑', 'üí°'];
                destaques.forEach((item, idx) => {
                    const li = document.createElement('div');
                    li.className = 'card-destaque';

                    const iconElem = document.createElement('span');
                    iconElem.textContent = icons[idx % icons.length];
                    iconElem.className = 'icon';
                    li.appendChild(iconElem);

                    const textoElem = document.createElement('span');
                    textoElem.textContent = item.texto;
                    li.appendChild(textoElem);

                    lista.appendChild(li);
                });
            });
        // Fun√ß√£o auxiliar para escapar HTML
        function escapeHtml(str) {
            return String(str || '')
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function extrairIdYoutube(url) {
            if (!url || typeof url !== 'string') return null;
            // regex que captura o ID de 11 caracteres
            const m = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|v\/|.+\bv=))([A-Za-z0-9_-]{11})/);
            return m ? m[1] : null;
        }

        // Carrega e renderiza os v√≠deos em cards (com descri√ß√£o)
        async function carregarVideosPublico() {
    const res = await fetch(`${API_URL}/videos`);
    const videos = await res.json();
    const track = document.getElementById('video-track');
    track.innerHTML = '';

    // monta slides
    videos.forEach(v => {
      const slide = document.createElement('div');
      slide.className = 'carousel-slide';

      let mediaHtml = '';
      if (v.url && (v.url.includes('youtube.com') || v.url.includes('youtu.be'))) {
        const youtubeId = extrairIdYoutube(v.url);
        if (youtubeId) {
          mediaHtml = `<iframe src="https://www.youtube.com/embed/${youtubeId}" title="${escapeHtml(v.nome)}" loading="lazy" frameborder="0" allowfullscreen></iframe>`;
        } else {
          mediaHtml = `<iframe src="${escapeHtml(v.url)}" title="${escapeHtml(v.nome)}" loading="lazy" frameborder="0" allowfullscreen></iframe>`;
        }
      } else {
        mediaHtml = `<video controls preload="metadata" src="${escapeHtml(v.url)}"></video>`;
      }

      slide.innerHTML = `
        <div class="video-media">${mediaHtml}</div>
        <h4 class="video-title">${escapeHtml(v.nome)}</h4>
        ${v.descricao ? `<p class="video-desc">${escapeHtml(v.descricao)}</p>` : ''}
      `;
      track.appendChild(slide);
    });

    initCarousel('#video-carousel', '#video-track');
  }

  // Carousel gen√©rico (3/2/1 responsivo)
  function initCarousel(carouselSelector, trackSelector) {
    const carousel = document.querySelector(carouselSelector);
    const track = document.querySelector(trackSelector);
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    let slides = Array.from(track.children);
    let slidesPerView = getSlidesPerView();
    let index = 0;

    function getSlidesPerView() {
      const w = window.innerWidth;
      if (w >= 1100) return 3;
      if (w >= 700) return 2;
      return 1;
    }

    function applySizes() {
      slides = Array.from(track.children);
      slidesPerView = getSlidesPerView();
      slides.forEach(s => {
        s.style.flex = `0 0 ${100 / slidesPerView}%`;
      });
      // garantir que index esteja no intervalo
      index = Math.min(index, Math.max(0, slides.length - slidesPerView));
      moveToIndex(index);
      updateButtons();
    }

    function moveToIndex(i) {
      const percent = (i * 100) / slidesPerView;
      track.style.transform = `translateX(-${percent}%)`;
    }

    function updateButtons() {
      prevBtn.disabled = index <= 0;
      nextBtn.disabled = index >= Math.max(0, slides.length - slidesPerView);
    }

    prevBtn.onclick = () => {
      index = Math.max(0, index - 1);
      moveToIndex(index);
      updateButtons();
    };
    nextBtn.onclick = () => {
      index = Math.min(Math.max(0, slides.length - slidesPerView), index + 1);
      moveToIndex(index);
      updateButtons();
    };

    // teclado: ‚Üê e ‚Üí
    carousel.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prevBtn.click();
      if (e.key === 'ArrowRight') nextBtn.click();
    });

    // recalcular em resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(applySizes, 120);
    });

    // inicializa
    applySizes();
  }

  document.addEventListener('DOMContentLoaded', carregarVideosPublico);
</script>
</body>

</html>